#!/usr/bin/make -f

SHELL := /bin/bash

override_dh_auto_build:
	set -ex && \
		export CGO_ENABLED=1 && \
		go run \
			-mod vendor -buildmode pie -v \
			-ldflags "-s -w" \
			./cmd/seccomp/generate.go

override_dh_auto_install:
	install -Dpm755 -d debian/tmp/etc/containers
	install -Dpm755 -d debian/tmp/usr/share/containers
	install -Dpm755 -t debian/tmp/etc/containers tests/policy.json
	install -Dpm755 -t debian/tmp/etc/containers tests/registries.conf
	install -Dpm755 -t debian/tmp/usr/share/containers pkg/config/containers.conf
	install -Dpm755 -t debian/tmp/usr/share/containers pkg/seccomp/seccomp.json
	install -Dpm755 -t debian/tmp/usr/share/containers vendor/github.com/containers/storage/storage.conf

override_dh_auto_test:

override_dh_auto_clean:

%:
	dh $@
